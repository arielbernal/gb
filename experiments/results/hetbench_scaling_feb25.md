# Het-Bench Scaling Comparison: het_lacam vs hetpibt
**Date:** 2025-02-25
**Map:** room120.map (120x120)
**Fleets:** cs=1 (v=1.0), cs=6 (v=0.17), cs=11 (v=0.09)
**Timeout:** 60s
**Scenarios:** Generated by gen_scaling.py (seed=42), no --swap-xy

## Agent Distribution
| Agents | cs=1 | cs=6 | cs=11 |
|--------|------|------|-------|
| 15     | 9    | 4    | 2     |
| 20     | 12   | 5    | 3     |
| 25     | 13   | 8    | 4     |
| 30     | 16   | 9    | 5     |
| 40     | 22   | 12   | 6     |
| 60     | 34   | 17   | 9     |

## Results

| agents | het_lacam goals% | het_lacam SOC | het_lacam time | hetpibt goals% | hetpibt SOC | hetpibt time |
|--------|------------------|---------------|----------------|----------------|-------------|--------------|
| 15     | 100% (15/15)     | 1540          | 60s (full)     | 100% (15/15)   | 1317        | 28ms         |
| 20     | **FAILED**       | —             | 60s (timeout)  | 100% (20/20)   | 1349        | 25ms         |
| 25     | 100% (25/25)     | 2785          | 60s (full)     | 28% (7/25)     | 390         | 67ms         |
| 30     | **FAILED**       | —             | 60s (timeout)  | 13% (4/30)     | 471         | 67ms         |
| 40     | 100% (40/40)     | 7892          | 60s (full)     | 15% (6/40)     | 286         | 72ms         |
| 60     | **FAILED**       | —             | 60s (timeout)  | —              | —           | —            |

## Key Observations

1. **het_lacam is NOT monotonically better with scale.** It solved 15, 25, and 40 agents but FAILED on 20, 30, and 60. This is instance-specific — different agent placements create configurations that LaCAM's search cannot crack within 60s, regardless of agent count.

2. **hetpibt solved 20 agents perfectly** (100%, 25ms) where het_lacam failed. This shows PIBT's greedy approach can outperform search-based methods on configurations where local decisions happen to be globally sufficient.

3. **hetpibt degrades rapidly past 20 agents**: 100% → 28% → 13% → 15% goals. The low makespan/SOC values at 25+ agents reflect early termination — most agents never reach goals.

4. **At 15 and 20 agents, hetpibt produces better SOC** (1317 vs 1540 at N=15) — PIBT finds shorter paths when congestion is low.

5. **het_lacam's PIBT failure patterns explain the timeouts:**
   - 20 agents: 2.3% PIBT fail rate but no solution found (search tree exhausted without valid path)
   - 25 agents: 7.8% PIBT fail rate but solved (lucky search tree exploration)
   - 30 agents: 3.9% PIBT fail rate, no solution
   - 60 agents: 35% PIBT fail rate, no solution

6. **The failures suggest het_lacam has a search completeness issue** in heterogeneous settings. The PIBT low-level planner failing in certain configurations prevents LaCAM from exploring valid branches. This is an area for improvement.

## Solver Details
- **het_lacam**: LaCAM-based search with heterogeneous fleet support. Uses PIBT as low-level planner within LaCAM's high-level search tree. Uses full timeout for optimization when solution is found; reports FAILED if no valid solution is found.
- **hetpibt**: Pure PIBT with heterogeneous fleet support. Greedy, very fast, but can get stuck in livelock/deadlock when agent density or fleet diversity is high.

## Raw Output

### het_lacam 15 agents (SOLVED)
```
agents: 15, fleets: 3, base grid: 120x120
[PIBT diag] calls=50000 ok=50000 fail_s2=0 fail_s3=0
elapsed: 60318ms  solved  makespan: 241 (lb=241) sum_of_costs: 1540 (lb=859) sum_of_loss: 1332
```

### het_lacam 20 agents (FAILED)
```
agents: 20, fleets: 3, base grid: 120x120
[PIBT diag] calls=450000 ok=439796 fail_s2=2 fail_s3=10202
elapsed: 61275ms  failed to solve
elapsed: 61277ms  solved  makespan: 0 (lb=195) sum_of_costs: 0 (lb=1233) sum_of_loss: 0
```

### het_lacam 25 agents (SOLVED)
```
agents: 25, fleets: 3, base grid: 120x120
[PIBT diag] calls=50000 ok=46090 fail_s2=2280 fail_s3=1630
elapsed: 60429ms  solved  makespan: 222 (lb=222) sum_of_costs: 2785 (lb=1517) sum_of_loss: 2507
```

### het_lacam 30 agents (FAILED)
```
agents: 30, fleets: 3, base grid: 120x120
[PIBT diag] calls=400000 ok=384375 fail_s2=1568 fail_s3=14057
elapsed: 60956ms  failed to solve
elapsed: 60958ms  solved  makespan: 0 (lb=142) sum_of_costs: 0 (lb=1320) sum_of_loss: 0
```

### het_lacam 40 agents (SOLVED)
```
agents: 40, fleets: 3, base grid: 120x120
elapsed: 62422ms  solved  makespan: 596 (lb=188, ub=3.18) sum_of_costs: 7892 (lb=2034) sum_of_loss: 6303
```

### het_lacam 60 agents (FAILED)
```
agents: 60, fleets: 3, base grid: 120x120
[PIBT diag] calls=100000 ok=64672 fail_s2=3011 fail_s3=32317
elapsed: 60211ms  failed to solve
elapsed: 60213ms  solved  makespan: 0 (lb=219) sum_of_costs: 0 (lb=3871) sum_of_loss: 0
```

### hetpibt 15 agents
```
comp_time(ms)=28  feasible=1  makespan=242  sum_of_costs=1317  goals_reached=15/15
```

### hetpibt 20 agents
```
comp_time(ms)=25  feasible=1  makespan=196  sum_of_costs=1349  goals_reached=20/20
```

### hetpibt 25 agents
```
comp_time(ms)=67  feasible=1  makespan=21  sum_of_costs=390  goals_reached=7/25
```

### hetpibt 30 agents
```
comp_time(ms)=67  feasible=1  makespan=22  sum_of_costs=471  goals_reached=4/30
```

### hetpibt 40 agents
```
comp_time(ms)=72  feasible=1  makespan=18  sum_of_costs=286  goals_reached=6/40
```
